{% extends 'ThemeBundle::Base/base.html.twig' %}


{% block body %}
<section class="content-header">
    <h1>
        Pagamento
        <small>editar pagamento</small>
    </h1>

    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Pagamento</a></li>
        <li><a href="#">Pagamento</a></li>
        <li class="active">Edição</li>
    </ol>
</section>

<section class="content">
    <div class="box">
        <div class="box-header with-border">
            <h3 class="box-title">Pagamento</h3>
            <div class="box-tools">
                <div style="width: auto;" class="input-group">

                </div>
            </div>
        </div>

        {{ form_start(form, {'attr': {'class': 'form-horizontal'}}) }}

        <div class="box-body">
            <div class="form-group">
                {{ form_label(form.paymentType, 'Tipo', {'label_attr': {'class': 'col-md-3 control-label' }}) }}
                <div class="col-md-9">
                    <div class="input-group" style="width: 100%;">
                        {{ form_widget(form.paymentType, {'attr': {'class': 'chosen-select form-control'}}) }}
                        {{ form_errors(form.paymentType) }}
                    </div>
                </div>
            </div>

            <div class="form-group">
                {{ form_label(form.paymentMadeAt, 'Pagamento efetuado em:', {'label_attr': {'class': 'col-md-3 control-label' }}) }}
                <div class="col-md-9">
                    <div class="input-group" style="width: 100%;">
                        {{ form_widget(form.paymentMadeAt, {'attr': {'class': 'date-picker form-control'}}) }}
                        {{ form_errors(form.paymentMadeAt) }}
                    </div>
                </div>
            </div>

            <div class="form-group">
                {{ form_label(form.purchaseMadeAt, 'Compra efetuada em:', {'label_attr': {'class': 'col-md-3 control-label' }}) }}
                <div class="col-md-9">
                    <div class="input-group" style="width: 100%;">
                        {{ form_widget(form.purchaseMadeAt, {'attr': {'class': 'date-picker form-control'}}) }}
                        {{ form_errors(form.purchaseMadeAt) }}
                    </div>
                </div>
            </div>

            <div class="form-group">
                {{ form_label(form.paymentForm, 'Forma de Pagamento', {'label_attr': {'class': 'col-md-3 control-label' }}) }}
                <div class="col-md-9">
                    <div class="input-group" style="width: 100%;">
                        {{ form_widget(form.paymentForm, {'attr': {'class': 'chosen-select form-control'}}) }}
                        {{ form_errors(form.paymentForm) }}
                    </div>
                </div>
            </div>

            <div class="form-group">
                {{ form_label(form.card, 'Cartão?', {'label_attr': {'class': 'col-md-3 control-label' }}) }}
                <div class="col-md-9">
                    <div class="input-group" style="width: 100%;">
                        {{ form_widget(form.card, {'attr': {'class': 'chosen-select form-control'}}) }}
                        {{ form_errors(form.card) }}
                    </div>
                </div>
            </div>

            <div class="form-group">
                {{ form_label(form.price, 'Valor', {'label_attr': {'class': 'col-md-3 control-label' }}) }}
                <div class="col-md-9">
                    <div class="input-group" style="width: 100%;">

                    </div>
                    <div class="input-group">
                        <span class="input-group-addon">R$</span>
                        {{ form_widget(form.price, {'attr': {'class': 'form-control number-format-2'}}) }}
                        {{ form_errors(form.price) }}
                    </div>
                </div>
            </div>

            <div class="form-group">
                {{ form_label(form.name, 'Título', {'label_attr': {'class': 'col-md-3 control-label' }}) }}
                <div class="col-md-9">
                    <div class="input-group" style="width: 100%;">
                        {{ form_widget(form.name, {'attr': {'class': 'form-control'}}) }}
                        {{ form_errors(form.name) }}
                    </div>
                </div>
            </div>

            <div class="form-group">
                {{ form_label(form.description, 'Descrição', {'label_attr': {'class': 'col-md-3 control-label' }}) }}
                <div class="col-md-9">
                    <div class="input-group" style="width: 100%;">
                        {{ form_widget(form.description, {'attr': {'class': 'form-control'}}) }}
                        {{ form_errors(form.description) }}
                    </div>
                </div>
            </div>

            <div class="form-group">
                {{ form_label(form.local, 'Local', {'label_attr': {'class': 'col-md-3 control-label' }}) }}
                <div class="col-md-9">
                    <div class="input-group" style="width: 100%;">
                        {{ form_widget(form.local, {'attr': {'class': 'form-control'}}) }}
                        {{ form_errors(form.local) }}
                    </div>
                </div>
            </div>

            <div class="form-group" style="display: none; visibility: hidden;">
                {{ form_label(form.plotQuantity, 'Parcelas', {'label_attr': {'class': 'col-md-3 control-label' }}) }}
                <div class="col-md-9">
                    <div class="input-group" style="width: 100%;">
                        {{ form_widget(form.plotQuantity, {'attr': {'class': 'form-control'}}) }}
                        {{ form_errors(form.plotQuantity) }}
                    </div>
                </div>
            </div>

            <div class="form-group">
                {{ form_label(form.status, 'Status', {'label_attr': {'class': 'col-md-3 control-label' }}) }}
                <div class="col-md-9">
                    <div class="input-group" style="width: 100%;">
                        {{ form_widget(form.status, {'attr': {'class': 'form-control'}}) }}
                        {{ form_errors(form.status) }}
                    </div>
                </div>
            </div>

        </div>

        <div class="box-footer">
            <div style="width: auto;" class="input-group">
                {{ form_widget(form.submit) }}
            </div>
        </div>

        {{ form_end(form) }}
    </div>

</section>


<section class="content">
    <div class="box">
        <div class="box-header with-border">
            <h3 class="box-title">Anexos ao pagamento</h3>
        </div>

        <div class="box-body">
            <div class="table-responsive mailbox-messages">

                <div id="mupload-container">
                    <a href="javascript:;" id="upload-browse" class="upload-browse btn btn-success">
                        <i class="fa fa-file-image-o"></i> [+] Selecionar novo(s) arquivo(s)
                    </a>

                    <a id="start-upload" href="javascript:;" class='btn btn-primary mupload-upload'>
                        <i class="fa fa-upload "></i> Enviar arquivo(s) selecionado(s)
                    </a>
                </div>

                <ul id="filelist"></ul>
                <pre id="console"></pre>

                {% if attachment is defined and attachment is not empty %}
                <p>Total de arquivos: {{ attachment|length }}
                <table class="table table-hover table-striped">
                    <thead>
                        <tr>
                            <td>#</td>
                            <td>Nome</td>
                            <td>Ação</td>
                            <td></td>
                        </tr>
                    </thead>
                    <tbody>
                        {% set count = 1 %}
                        {% for entity in attachment %}
                        <tr>
                            <td>{{ count }}.</td>
                            <td>{{ entity.file }}</td>
                            <td>
                                <a href="{{ entity.getImageCompleteToBrowser(entity.file) }}" target="_blank" class="btn btn-primary">visualizar</a>
                                <a href="{{ path('payment_attachment_delete', {'id': entity.id, 'payment': entity.payment.id}) }}" class="btn btn-danger delete">excluir</a>
                            </td>
                        </tr>
                        {% set count = count + 1 %}
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p>Nenhum arquivo adicionado.</p>
                {% endif %}
            </div>
        </div>
    </div>

</section>

<script type="text/javascript">
var uploader = new plupload.Uploader({
    browse_button: 'upload-browse',
    url: '{{ path('payment_attachment_new', {'payment': entity.id}) }}',
    unique_names : true,
    preinit: attachCallbacks,
    multipart_params : null
});

uploader.init();

uploader.bind('FilesAdded', function(up, files) {
    var html = '';
    plupload.each(files, function(file) {
        html += '<li id="' + file.id + '">'+ file.name + ' (' + plupload.formatSize(file.size) + ') <b></b></li>';
    });
    document.getElementById('filelist').innerHTML += html;
});

function attachCallbacks(uploader) {
    uploader.bind('FileUploaded', function(Up, File, Response) {
        if((uploader.total.uploaded + 1) == uploader.files.length)
        {
            location.reload();
        }
    });
}

uploader.bind('UploadProgress', function(up, file) {
    document.getElementById(file.id).getElementsByTagName('b')[0].innerHTML = '<span class="upload-file-porcent">' + file.percent + "%</span>";
});

uploader.bind('Error', function(up, err) {
    document.getElementById('console').innerHTML += "\nError #" + err.code + ": " + err.message;
});

document.getElementById('start-upload').onclick = function() {
    uploader.start();
};
</script>

{% endblock %}
